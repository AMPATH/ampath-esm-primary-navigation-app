/** @module @category API */ import { fhirBaseUrl, openmrsFetch } from "@openmrs/esm-api";
import { getSynchronizationItems } from "@openmrs/esm-offline";
export async function fetchCurrentPatient(patientUuid, fetchInit, includeOfflinePatients = true) {
    if (patientUuid) {
        let err = null;
        const [onlinePatient, offlinePatient] = await Promise.all([
            openmrsFetch(`${fhirBaseUrl}/Patient/${patientUuid}`, fetchInit).catch((e)=>err = e),
            includeOfflinePatients ? getOfflineRegisteredPatientAsFhirPatient(patientUuid) : Promise.resolve(null)
        ]);
        if (onlinePatient.ok) {
            return onlinePatient.data;
        }
        if (offlinePatient) {
            return offlinePatient;
        }
        if (err) {
            throw err;
        }
    }
    return null;
}
async function getOfflineRegisteredPatientAsFhirPatient(patientUuid) {
    const patientRegistrationSyncItems = await getSynchronizationItems('patient-registration');
    const patientSyncItem = patientRegistrationSyncItems.find((item)=>item.fhirPatient.id === patientUuid);
    return patientSyncItem?.fhirPatient ?? null;
}
