/** @module @category UI */ import { useEffect } from "react";
import { useServerInfinite } from "./useOpenmrsInfinite.js";
import { openmrsServerPaginationHandlers } from "./useOpenmrsPagination.js";
/**
 * Most OpenMRS REST endpoints that return a list of objects, such as getAll or search, are server-side paginated.
 * This hook handles fetching results from *all* pages of a paginated OpenMRS REST endpoint, making multiple requests
 * as needed.
 *
 * @see `useOpenmrsPagination`
 * @see `useOpenmrsInfinite`
 * @see `useFhirFetchAll`
 *
 * @param url The URL of the paginated OpenMRS REST endpoint. Note that the `limit` GET param can be set to specify
 *            the page size; if not set, the page size defaults to the `webservices.rest.maxResultsDefault` value defined
 *            server-side.
 *            Similar to useSWRInfinite, this param can be null to disable fetching.
 * @param options The options object
 * @returns a UseOpenmrsInfiniteReturnObject object
 */ export function useOpenmrsFetchAll(url, options = {}) {
    return useServerFetchAll(url, openmrsServerPaginationHandlers, options);
}
export function useServerFetchAll(url, serverPaginationHandlers, options = {}) {
    const response = useServerInfinite(url, serverPaginationHandlers, options);
    const { hasMore, error, data, loadMore, isLoading, nextUri } = response;
    useEffect(()=>{
        if (hasMore && !error) {
            loadMore();
        }
    }, [
        hasMore,
        nextUri
    ]);
    if (options.partialData) {
        return response;
    } else {
        return {
            ...response,
            data: hasMore || error ? undefined : data,
            isLoading: isLoading || hasMore
        };
    }
}
